<!-- Header with FetchSafe logo and back button -->
<ion-header class="fetchsafe-header">
  <ion-toolbar>
    <div class="header-container">
      <ion-button fill="clear" class="back-btn" (click)="goBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>

      <div class="logo-container">
        <div class="logo-circle">
          <ion-icon name="shield-checkmark" class="logo-icon"></ion-icon>
        </div>
        <span class="logo-text">FetchSafe</span>
      </div>

      <div class="header-spacer"></div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="schedule-content">
  <div class="page-title">
    <h1>Set Schedule</h1>
  </div>

  <form (ngSubmit)="saveSchedule()" class="schedule-form">
    <!-- Fetcher's Name Section -->
    <div class="form-section">
      <label class="section-label">Fetcher's Name</label>
      <div class="select-container">
        <ion-select
          [(ngModel)]="selectedFetcher"
          name="selectedFetcher"
          placeholder="Select Family Members"
          interface="popover"
          class="custom-select">
          <ion-select-option
            *ngFor="let member of availableFetchers"
            [value]="member.name">
            {{ member.name }} ({{ member.role }})
          </ion-select-option>
        </ion-select>
        <ion-icon name="chevron-down" class="select-arrow"></ion-icon>
      </div>
    </div>

    <!-- Days Section -->
    <div class="form-section">
      <label class="section-label">Days</label>
      <div class="days-container">
        <div class="day-button"
             [class.selected]="selectedDays.includes('Mon')"
             (click)="toggleDay('Mon')">
          Mon
        </div>
        <div class="day-button"
             [class.selected]="selectedDays.includes('Tues')"
             (click)="toggleDay('Tues')">
          Tues
        </div>
        <div class="day-button"
             [class.selected]="selectedDays.includes('Wed')"
             (click)="toggleDay('Wed')">
          Wed
        </div>
        <div class="day-button"
             [class.selected]="selectedDays.includes('Thur')"
             (click)="toggleDay('Thur')">
          Thur
        </div>
        <div class="day-button"
             [class.selected]="selectedDays.includes('Fri')"
             (click)="toggleDay('Fri')">
          Fri
        </div>
      </div>
    </div>

    <!-- Date Section -->
    <div class="form-section">
      <label class="section-label">Date</label>
      <div class="date-info" *ngIf="selectedDays.length > 0">
        <small class="date-hint">
          Calendar will only show dates for: {{ selectedDays.join(', ') }}
        </small>
      </div>
      <div class="date-container">
        <ion-button
          fill="outline"
          class="date-button"
          (click)="openDatePicker()"
          [disabled]="selectedDays.length === 0">
          <ion-icon name="calendar-outline" slot="start"></ion-icon>
          {{ selectedDate || 'Select Date' }}
        </ion-button>
      </div>
    </div>

    <!-- Time Section -->
    <div class="form-section">
      <label class="section-label">Time</label>
      <div class="time-container">
        <ion-button
          fill="outline"
          class="time-button"
          (click)="openTimePicker()">
          <ion-icon name="time-outline" slot="start"></ion-icon>
          {{ selectedTime || 'Select Time' }}
        </ion-button>
      </div>
    </div>

    <!-- Done Button -->
    <div class="button-container">
      <ion-button
        expand="block"
        class="done-button"
        type="submit"
        [disabled]="!isFormValid()">
        Done
      </ion-button>
    </div>
  </form>

  <!-- Bottom spacing for navigation -->
  <div class="bottom-spacing"></div>

  <!-- Date Picker Modal -->
  <ion-modal [isOpen]="showDatePicker" (didDismiss)="showDatePicker = false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Select Date</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="showDatePicker = false">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-datetime
          presentation="date"
          [min]="minDate"
          [isDateEnabled]="isDateEnabled"
          (ionChange)="onDateChange($event)">
        </ion-datetime>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Time Picker Modal -->
  <ion-modal [isOpen]="showTimePicker" (didDismiss)="showTimePicker = false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Select Time</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="showTimePicker = false">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <div class="time-picker-content">
          <!-- Custom Time Input -->
          <div class="custom-time-section">
            <h3>Custom Time</h3>
            <div class="custom-time-input">
              <input
                type="time"
                [(ngModel)]="customTime"
                name="customTime"
                class="time-input-field">
              <ion-button
                fill="clear"
                size="small"
                (click)="selectCustomTime()">
                Use Custom Time
              </ion-button>
            </div>
          </div>

          <!-- Divider -->
          <div class="time-divider">
            <span>Or select from available times</span>
          </div>

          <!-- Available Time Slots -->
          <div class="time-slots">
            <div
              *ngFor="let time of availableTimes"
              class="time-slot"
              (click)="selectTime(time)">
              {{ time }}
            </div>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<!-- FetchSafe Bottom Navigation -->
<ion-footer class="fetchsafe-bottom-nav">
  <ion-toolbar>
    <div class="fetchsafe-nav-container">
      <div class="fetchsafe-nav-item active" (click)="goHome()">
        <ion-icon name="home-outline"></ion-icon>
        <span class="fetchsafe-nav-label">Home</span>
      </div>
      <div class="fetchsafe-nav-item" (click)="goToFamily()">
        <ion-icon name="people-outline"></ion-icon>
        <span class="fetchsafe-nav-label">Family</span>
      </div>
      <div class="fetchsafe-nav-item panic-nav">
        <div class="fetchsafe-panic-button" (click)="panicAlert()">
          <ion-icon name="warning-outline"></ion-icon>
          <span class="fetchsafe-nav-label">Panic</span>
        </div>
      </div>
      <div class="fetchsafe-nav-item" (click)="goToDocuments()">
        <ion-icon name="document-text-outline"></ion-icon>
        <span class="fetchsafe-nav-label">Pickup Logs</span>
      </div>
      <div class="fetchsafe-nav-item" (click)="goToSettings()">
        <ion-icon name="settings-outline"></ion-icon>
        <span class="fetchsafe-nav-label">Settings</span>
      </div>
    </div>
  </ion-toolbar>
</ion-footer>
